/*
 * OpenGL基本プログラムの説明
 * 
 * このファイルは、OpenGLプログラムの基本的な構造を説明するためのものです。
 * 各部分の役割を理解してから、main.cに実際のコードを書いてみましょう。
 */

// ========================================
// 1. ヘッダーファイルのインクルード
// ========================================

#include <GL/glew.h>        // OpenGLの拡張機能を使うために必要
#include <GLFW/glfw3.h>     // ウィンドウ作成とイベント処理に必要
#include <stdio.h>          // printf()などの標準入出力に必要

/*
 * 重要: GLEWは必ずGLFWより先にインクルードすること！
 */


// ========================================
// 2. main関数の基本構造
// ========================================

int main(void)
{
    GLFWwindow* window;  // ウィンドウを管理する変数（ポインタ）

    // ----------------------------------------
    // ステップ1: GLFWの初期化
    // ----------------------------------------
    /*
     * glfwInit() - GLFWライブラリを初期化する
     * 戻り値: 成功したら1、失敗したら0
     * 
     * これを最初に呼ばないと、GLFWの機能が使えません。
     */
    if (!glfwInit()) {
        printf("GLFWの初期化に失敗しました\n");
        return -1;
    }


    // ----------------------------------------
    // ステップ2: ウィンドウの作成
    // ----------------------------------------
    /*
     * glfwCreateWindow() - ウィンドウを作成する
     * 引数1: 幅（ピクセル）
     * 引数2: 高さ（ピクセル）
     * 引数3: ウィンドウのタイトル（文字列）
     * 引数4: モニター設定（NULLでウィンドウモード）
     * 引数5: 共有設定（通常はNULL）
     * 戻り値: ウィンドウのポインタ（失敗したらNULL）
     */
    window = glfwCreateWindow(800, 600, "My First OpenGL Window", NULL, NULL);
    if (!window) {
        printf("ウィンドウの作成に失敗しました\n");
        glfwTerminate();  // GLFWを終了
        return -1;
    }


    // ----------------------------------------
    // ステップ3: OpenGLコンテキストを有効にする
    // ----------------------------------------
    /*
     * glfwMakeContextCurrent() - このウィンドウでOpenGLを使えるようにする
     * 
     * OpenGLの描画命令は、このコンテキストに対して実行されます。
     */
    glfwMakeContextCurrent(window);


    // ----------------------------------------
    // ステップ4: GLEWの初期化
    // ----------------------------------------
    /*
     * glewInit() - GLEWを初期化する
     * 戻り値: GLEW_OK なら成功
     * 
     * 重要: これは必ずウィンドウ作成とコンテキスト設定の後に呼ぶこと！
     */
    if (glewInit() != GLEW_OK) {
        printf("GLEWの初期化に失敗しました\n");
        return -1;
    }


    // ----------------------------------------
    // ステップ5: 背景色の設定
    // ----------------------------------------
    /*
     * glClearColor() - 画面をクリアする時の色を設定
     * 引数: R（赤）, G（緑）, B（青）, A（透明度）
     * 値の範囲: 0.0 ～ 1.0
     * 
     * 例: 青色 = (0.0, 0.0, 1.0, 1.0)
     *     赤色 = (1.0, 0.0, 0.0, 1.0)
     *     白色 = (1.0, 1.0, 1.0, 1.0)
     *     黒色 = (0.0, 0.0, 0.0, 1.0)
     */
    glClearColor(0.0f, 0.0f, 1.0f, 1.0f);  // 青色に設定


    // ----------------------------------------
    // ステップ6: メインループ
    // ----------------------------------------
    /*
     * while (!glfwWindowShouldClose(window))
     * 
     * ウィンドウが閉じられるまで繰り返す。
     * ユーザーが×ボタンを押すか、ESCキーを押すまでループが続きます。
     */
    while (!glfwWindowShouldClose(window))
    {
        // --- 描画処理 ---
        
        /*
         * glClear() - 画面をクリアする（塗りつぶす）
         * 引数: GL_COLOR_BUFFER_BIT = 色バッファをクリア
         * 
         * glClearColor()で設定した色で画面全体を塗りつぶします。
         */
        glClear(GL_COLOR_BUFFER_BIT);

        
        // ここに図形を描く処理を書く（今回は何も描かない）
        

        /*
         * glfwSwapBuffers() - バッファを入れ替える
         * 
         * OpenGLは「ダブルバッファリング」という仕組みを使います。
         * - 裏バッファ: 次の画面を描画する場所
         * - 表バッファ: 今表示されている画面
         * 
         * この関数で裏と表を入れ替えて、描いた画面を表示します。
         * これをしないと画面が更新されません！
         */
        glfwSwapBuffers(window);

        
        /*
         * glfwPollEvents() - イベントを処理する
         * 
         * キーボード入力、マウス操作、ウィンドウのリサイズなどの
         * イベントを処理します。これを呼ばないとウィンドウが反応しません。
         */
        glfwPollEvents();
    }


    // ----------------------------------------
    // ステップ7: 終了処理
    // ----------------------------------------
    /*
     * glfwTerminate() - GLFWを終了し、リソースを解放する
     * 
     * プログラムが終わる前に必ず呼びましょう。
     */
    glfwTerminate();

    return 0;
}


// ========================================
// プログラムの流れのまとめ
// ========================================
/*
 * 1. GLFWを初期化
 * 2. ウィンドウを作成
 * 3. OpenGLコンテキストを設定
 * 4. GLEWを初期化
 * 5. 背景色を設定
 * 6. メインループ
 *    - 画面をクリア
 *    - 図形を描画（今回はなし）
 *    - バッファを入れ替え
 *    - イベントを処理
 * 7. GLFWを終了
 */


// ========================================
// よくある質問
// ========================================
/*
 * Q1: なぜGLEWとGLFWの両方が必要なの？
 * A1: 
 *   - GLFW: ウィンドウを作る、キーボード・マウスを扱う
 *   - GLEW: OpenGLの新しい機能を使えるようにする
 *   役割が違うので、両方必要です。
 * 
 * Q2: ダブルバッファリングって何？
 * A2: 
 *   画面に直接描くと、描画中の途中の状態が見えてチラつきます。
 *   そこで、裏で完成させてから一気に表示する仕組みです。
 * 
 * Q3: glfwPollEvents()を忘れるとどうなる？
 * A3: 
 *   ウィンドウが「応答なし」状態になります。
 *   イベント処理をしないと、OSがプログラムをフリーズと判断します。
 * 
 * Q4: glClear()を忘れるとどうなる？
 * A4: 
 *   前のフレームの描画が残ったままになり、画面がおかしくなります。
 *   毎フレーム必ずクリアしましょう。
 */
