#include <stdio.h>
#include <string.h>

/*
========================================
値渡し vs ポインタ渡し
========================================
メモリの使い方の違いを理解しよう
*/

struct Product {
    char name[50];
    int price;
    int stock;
};

// ========================================
// 方法1: 値渡し（メモリを多く使う）
// ========================================
void printProductByValue(struct Product p) {
    // p は構造体のコピー
    printf("商品名: %s, 価格: %d円, 在庫: %d個\n", p.name, p.price, p.stock);
}

// ========================================
// 方法2: ポインタ渡し（メモリを節約）
// ========================================
void printProductByPointer(struct Product *p) {
    // p はアドレスだけ
    printf("商品名: %s, 価格: %d円, 在庫: %d個\n", (*p).name, (*p).price, (*p).stock);
}

// ========================================
// 値渡しで変更を試みる（失敗する例）
// ========================================
void sellByValue(struct Product p, int quantity) {
    p.stock -= quantity;  // コピーを変更
    printf("関数内の在庫: %d個\n", p.stock);
}

// ========================================
// ポインタ渡しで変更する（成功する例）
// ========================================
void sellByPointer(struct Product *p, int quantity) {
    (*p).stock -= quantity;  // 元の変数を変更
    printf("関数内の在庫: %d個\n", (*p).stock);
}

int main() {
    printf("=== 値渡し vs ポインタ渡し ===\n\n");
    
    struct Product apple = {"りんご", 150, 20};
    
    // ========================================
    // 1. メモリの使い方の違い
    // ========================================
    printf("--- 1. メモリの使い方の違い ---\n\n");
    
    printf("構造体のサイズ: %zu バイト\n", sizeof(struct Product));
    printf("ポインタのサイズ: %zu バイト\n\n", sizeof(struct Product *));
    
    printf("値渡し:\n");
    printf("  構造体全体（%zuバイト）をコピーして渡す\n", sizeof(struct Product));
    printf("  メモリを多く使う\n\n");
    
    printf("ポインタ渡し:\n");
    printf("  アドレス（%zuバイト）だけを渡す\n", sizeof(struct Product *));
    printf("  メモリを節約できる\n\n");
    
    // ========================================
    // 2. 図で理解
    // ========================================
    printf("--- 2. 図で理解 ---\n\n");
    
    printf("【値渡し】\n");
    printf("main関数:\n");
    printf("  apple = {\"りんご\", 150, 20}  ← 元のデータ\n");
    printf("  ↓ コピーを作る\n");
    printf("関数:\n");
    printf("  p = {\"りんご\", 150, 20}      ← コピー（別物）\n");
    printf("  メモリを2倍使う！\n\n");
    
    printf("【ポインタ渡し】\n");
    printf("main関数:\n");
    printf("  apple = {\"りんご\", 150, 20}  ← 元のデータ\n");
    printf("  ↓ アドレスだけ渡す\n");
    printf("関数:\n");
    printf("  p = 0x1000                   ← アドレスだけ（小さい）\n");
    printf("  メモリを節約！\n\n");
    
    // ========================================
    // 3. 実際に試してみる
    // ========================================
    printf("--- 3. 実際に試してみる ---\n\n");
    
    printf("【値渡しで表示】\n");
    printProductByValue(apple);
    printf("\n");
    
    printf("【ポインタ渡しで表示】\n");
    printProductByPointer(&apple);
    printf("\n");
    
    // ========================================
    // 4. 変更の違い
    // ========================================
    printf("--- 4. 変更の違い ---\n\n");
    
    printf("元の在庫: %d個\n\n", apple.stock);
    
    printf("【値渡しで販売を試みる】\n");
    sellByValue(apple, 5);
    printf("元の在庫: %d個\n", apple.stock);
    printf("→ 変更されていない！（コピーを変更しただけ）\n\n");
    
    printf("【ポインタ渡しで販売】\n");
    sellByPointer(&apple, 5);
    printf("元の在庫: %d個\n", apple.stock);
    printf("→ 変更された！（元の変数を変更）\n\n");
    
    // ========================================
    // 5. どちらを使うべきか
    // ========================================
    printf("--- 5. どちらを使うべきか ---\n\n");
    
    printf("【値渡しを使う場合】\n");
    printf("✅ 構造体が小さい（数バイト程度）\n");
    printf("✅ 元の変数を変更したくない\n");
    printf("✅ 読み取り専用で使いたい\n\n");
    
    printf("【ポインタ渡しを使う場合】\n");
    printf("✅ 構造体が大きい\n");
    printf("✅ 元の変数を変更したい\n");
    printf("✅ メモリを節約したい\n");
    printf("✅ 実践的なプログラムではこちらが多い\n\n");
    
    // ========================================
    // 6. 具体例で比較
    // ========================================
    printf("--- 6. 具体例で比較 ---\n\n");
    
    struct Product banana = {"バナナ", 100, 30};
    
    printf("構造体のサイズ: %zuバイト\n", sizeof(banana));
    printf("\n");
    
    printf("値渡しの場合:\n");
    printf("  関数を呼ぶたびに%zuバイトコピーされる\n", sizeof(banana));
    printf("  10回呼ぶと %zu バイト使う\n\n", sizeof(banana) * 10);
    
    printf("ポインタ渡しの場合:\n");
    printf("  関数を呼ぶたびに%zuバイトだけ渡す\n", sizeof(struct Product *));
    printf("  10回呼んでも %zu バイト\n\n", sizeof(struct Product *) * 10);
    
    // ========================================
    // まとめ
    // ========================================
    printf("========================================\n");
    printf("まとめ:\n");
    printf("========================================\n");
    printf("【値渡し】\n");
    printf("  void func(struct Product p)\n");
    printf("  呼び出し: func(apple)\n");
    printf("  特徴: 構造体全体をコピー\n");
    printf("  メモリ: 多く使う\n");
    printf("  変更: 元の変数は変わらない\n\n");
    
    printf("【ポインタ渡し】\n");
    printf("  void func(struct Product *p)\n");
    printf("  呼び出し: func(&apple)\n");
    printf("  特徴: アドレスだけ渡す\n");
    printf("  メモリ: 節約できる\n");
    printf("  変更: 元の変数を変更できる\n");
    printf("========================================\n");
    
    return 0;
}

/*
========================================
詳しい説明
========================================

1. 値渡し（Pass by Value）
   - 構造体全体をコピーして渡す
   - 関数内で変更しても元の変数は変わらない
   - メモリを多く使う
   - 構造体が大きいと遅くなる

2. ポインタ渡し（Pass by Pointer/Reference）
   - アドレスだけを渡す
   - 関数内で変更すると元の変数も変わる
   - メモリを節約できる
   - 構造体が大きくても速い

========================================
メモリ使用量の例
========================================

struct Product のサイズ: 約60バイト
ポインタのサイズ: 8バイト（64bit環境）

値渡しで100回呼ぶ:
  60 × 100 = 6,000 バイト

ポインタ渡しで100回呼ぶ:
  8 × 100 = 800 バイト

差: 5,200 バイト節約！

========================================
実践的なアドバイス
========================================

構造体を関数に渡すときは、基本的に
「ポインタ渡し」を使うのが一般的！

理由:
1. メモリを節約できる
2. 速度が速い
3. 元の変数を変更できる（必要な場合）

値渡しは、小さいデータ（int, charなど）や
元の変数を保護したい場合に使う。
*/
