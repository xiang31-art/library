#include <stdio.h>

/*
========================================
struct Product *p の意味
========================================
「構造体のポインタを受け取る」という意味
*/

struct Product {
    char name[50];
    int price;
    int stock;
};

// ========================================
// 1. 関数の引数としての struct Product *p
// ========================================

// この関数は「構造体のポインタを受け取る」
void sellProduct(struct Product *p, int quantity) {
    // p は構造体へのポインタ（アドレス）
    printf("受け取ったポインタのアドレス: %p\n", p);
    
    if((*p).stock >= quantity) {
        (*p).stock -= quantity;
        printf("%sを%d個販売しました\n", (*p).name, quantity);
    }
}

int main() {
    printf("=== struct Product *p の意味 ===\n\n");
    
    struct Product apple = {"りんご", 150, 20};
    
    // ========================================
    // 2. 「渡す」と「受け取る」の違い
    // ========================================
    printf("--- 1. 渡す側と受け取る側 ---\n\n");
    
    printf("【呼び出す側（渡す側）】\n");
    printf("appleのアドレス: %p\n", &apple);
    printf("&apple を渡す\n\n");
    
    printf("【関数側（受け取る側）】\n");
    printf("struct Product *p で受け取る\n");
    printf("p にはアドレスが入る\n\n");
    
    // 実際に呼び出す
    sellProduct(&apple, 5);
    
    printf("\n");
    
    // ========================================
    // 3. 詳しく説明
    // ========================================
    printf("--- 2. 詳しく説明 ---\n\n");
    
    printf("呼び出し: sellProduct(&apple, 5);\n");
    printf("          ↓\n");
    printf("          &apple（アドレス）を渡す\n");
    printf("          ↓\n");
    printf("関数定義: void sellProduct(struct Product *p, ...)\n");
    printf("          ↓\n");
    printf("          p にアドレスが入る\n");
    printf("          ↓\n");
    printf("          p は「構造体へのポインタ」\n\n");
    
    // ========================================
    // 4. 図で理解
    // ========================================
    printf("--- 3. 図で理解 ---\n\n");
    
    printf("メモリのイメージ:\n\n");
    printf("main関数:\n");
    printf("  apple = {\"りんご\", 150, 20}  ← アドレス: 0x1000\n");
    printf("  ↓\n");
    printf("  &apple を渡す\n");
    printf("  ↓\n");
    printf("sellProduct関数:\n");
    printf("  p = 0x1000  ← appleのアドレスが入っている\n");
    printf("  ↓\n");
    printf("  (*p) で apple の中身にアクセスできる\n\n");
    
    // ========================================
    // 5. 「渡す」の正確な意味
    // ========================================
    printf("--- 4. 「渡す」の正確な意味 ---\n\n");
    
    printf("正確には:\n");
    printf("「構造体のポインタを渡す」\n");
    printf("= 「構造体のアドレスを渡す」\n");
    printf("= 「構造体がどこにあるかの情報を渡す」\n\n");
    
    printf("関数側では:\n");
    printf("「構造体のポインタを受け取る」\n");
    printf("= 「構造体のアドレスを受け取る」\n");
    printf("= 「そのアドレスを使って構造体にアクセスできる」\n\n");
    
    // ========================================
    // 6. なぜポインタを使うのか？
    // ========================================
    printf("--- 5. なぜポインタを使うのか？ ---\n\n");
    
    printf("理由1: 元の構造体を変更できる\n");
    printf("  ポインタを使うと、関数内で変更した内容が\n");
    printf("  元の変数にも反映される\n\n");
    
    printf("理由2: メモリの節約\n");
    printf("  構造体全体をコピーせず、アドレスだけ渡すので効率的\n\n");
    
    // ========================================
    // 7. 実例で比較
    // ========================================
    printf("--- 6. 実例で比較 ---\n\n");
    
    struct Product banana = {"バナナ", 100, 30};
    
    printf("変更前の在庫: %d個\n", banana.stock);
    
    // ポインタを渡す（アドレスを渡す）
    sellProduct(&banana, 10);
    
    printf("変更後の在庫: %d個\n", banana.stock);
    printf("→ 元の変数が変更された！\n\n");
    
    // ========================================
    // まとめ
    // ========================================
    printf("========================================\n");
    printf("まとめ:\n");
    printf("========================================\n");
    printf("struct Product *p の意味:\n");
    printf("「構造体へのポインタを受け取る引数」\n\n");
    
    printf("呼び出し方:\n");
    printf("sellProduct(&apple, 5);\n");
    printf("            ↑\n");
    printf("         アドレスを渡す\n\n");
    
    printf("関数内:\n");
    printf("p にはアドレスが入っている\n");
    printf("(*p).メンバ名 でアクセスできる\n");
    printf("========================================\n");
    
    return 0;
}

/*
========================================
用語の整理
========================================

1. 「ポインタを渡す」
   = アドレスを渡す
   = どこにあるかの情報を渡す

2. 「ポインタを受け取る」
   = アドレスを受け取る
   = そのアドレスを使ってアクセスできる

3. struct Product *p
   = 「構造体へのポインタ型の変数p」
   = 「pには構造体のアドレスが入る」

========================================
具体例
========================================

// 構造体の定義
struct Product apple = {"りんご", 150, 20};

// 呼び出し
sellProduct(&apple, 5);
            ↑
         アドレスを渡す

// 関数定義
void sellProduct(struct Product *p, int quantity) {
                                   ↑
                          ポインタを受け取る
                          (アドレスが入る)
    
    // 使い方
    (*p).stock -= quantity;  // 元の変数を変更できる
}

========================================
覚え方
========================================

呼び出し側: &変数名  → アドレスを渡す
関数側:     型 *変数名 → ポインタを受け取る

ポインタ = アドレスを入れる箱
*/
